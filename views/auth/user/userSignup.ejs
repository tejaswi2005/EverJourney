<!-- views/auth/signup.ejs -->
<style>
  .auth-page { min-height:70vh; display:flex; align-items:center; justify-content:center; padding:3rem 1rem; }
  .auth-card { width:100%; max-width:1100px; display:grid; grid-template-columns:520px 1fr; gap:1.5rem; }
  .auth-panel { background: linear-gradient(180deg,#ffffff 0%, #f8fafc 100%); border-radius:.8rem; padding:1.6rem; box-shadow:0 10px 30px rgba(2,6,23,0.06); }

  /* ðŸ”¹ updated line: added max-height + overflow for scroll */
  .auth-form {
    background:#fff;
    padding:1.6rem;
    border-radius:.8rem;
    box-shadow:0 6px 18px rgba(2,6,23,0.06);
    max-height:80vh;
    overflow:auto;
  }

  .form-control { height:46px; border-radius:.6rem; }
  .btn-primary { border-radius:.6rem; padding:.6rem 1rem; }
  .section-title { font-weight:600; margin-bottom:.5rem; }
  .small-note { color:#6b7280; font-size:.9rem; }
  .error { background:#fff3f2; border:1px solid #ffd3cf; color:#9b1c1c; padding:.6rem; border-radius:.5rem; margin-bottom:.8rem; }
  .two-col { display:grid; grid-template-columns:1fr 1fr; gap:.75rem; }
  @media(max-width:980px){
    .auth-card { grid-template-columns:1fr; }
    .two-col { grid-template-columns:1fr; }
    .auth-form { max-height:none; } /* so mobile doesn't get weird tiny scroll area */
  }
</style>

<section class="container auth-page">
  <div class="auth-card">

    <div class="auth-panel">
      <div style="font-weight:700; color:#0b5cff; font-size:1.4rem;">Create your EverJourney account</div>
      <p class="small-note" style="margin-top:.5rem;">Sign up to book hotels and transport, manage bookings and receive exclusive offers.</p>

      <div style="margin-top:1rem;">
        <img src="/assets/signup-illustration.svg" alt="signup" style="width:100%; max-width:420px;">
      </div>

      <div class="hr" style="margin-top:1rem; height:1px; background:#eef2f7;"></div>

      <p class="small-note mt-2">Already have an account? <a href="/auth/login">Sign in</a></p>

      <div style="margin-top:1rem;">
        <strong>Why sign up?</strong>
        <ul class="small-note" style="margin-top:.5rem; padding-left:1.1rem;">
          <li>Faster booking & saved details</li>
          <li>Manage & cancel bookings</li>
          <li>Write reviews & access invoices</li>
        </ul>
      </div>
    </div>

    <div class="auth-form">
      <h4 class="mb-2">Create account</h4>

      <% if (typeof errors === 'string' && errors.length) { %>
        <div class="error"><%= errors %></div>
      <% } else if (Array.isArray(errors) && errors.length) { %>
        <% errors.forEach(e => { %><div class="error"><%= e %></div><% }) %>
      <% } else if (errors && typeof errors === 'object') { %>
        <% Object.keys(errors).forEach(k => { %>
          <div class="error"><strong><%= k %>:</strong> <%= errors[k] %></div>
        <% }) %>
      <% } %>

      <form id="signupForm" method="post" action="/auth/signup" novalidate>
        <input type="hidden" name="redirect" value="<%= old && old.redirect ? old.redirect : (req && req.query && req.query.redirect ? req.query.redirect : '') %>">

        <div class="section-title">Account</div>
        <div class="two-col">
          <div class="mb-3">
            <label class="form-label small">First name</label>
            <input class="form-control" name="first_name" value="<%= old && old.first_name ? old.first_name : '' %>" required>
          </div>
          <div class="mb-3">
            <label class="form-label small">Last name</label>
            <input class="form-control" name="last_name" value="<%= old && old.last_name ? old.last_name : '' %>">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label small">Email</label>
          <input class="form-control" type="email" name="email" required value="<%= old && old.email ? old.email : '' %>">
        </div>

        <div class="two-col">
          <div class="mb-3 position-relative">
            <label class="form-label small">Password</label>
            <input id="signupPwd" class="form-control" type="password" name="password" required minlength="8" placeholder="At least 8 characters">
          </div>
          <div class="mb-3">
            <label class="form-label small">Confirm password</label>
            <input id="signupPwd2" class="form-control" type="password" name="password_confirm" required>
          </div>
        </div>

        <div class="section-title mt-2">Profile</div>
        <div class="two-col">
          <div class="mb-3">
            <label class="form-label small">Phone</label>
            <input class="form-control" name="phone" value="<%= old && old.phone ? old.phone : '' %>" placeholder="+91 98765 43210">
          </div>
          <div class="mb-3">
            <label class="form-label small">Date of birth</label>
            <input class="form-control" type="date" name="dob" value="<%= old && old.dob ? old.dob : '' %>">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label small">Gender</label>
          <select name="gender" class="form-select">
            <option value="">Prefer not to say</option>
            <option value="female" <%= old && old.gender === 'female' ? 'selected' : '' %>>Female</option>
            <option value="male" <%= old && old.gender === 'male' ? 'selected' : '' %>>Male</option>
            <option value="other" <%= old && old.gender === 'other' ? 'selected' : '' %>>Other</option>
          </select>
        </div>

        <div class="section-title mt-2">Address (optional)</div>
        <div class="mb-3">
          <label class="form-label small">Address line 1</label>
          <input class="form-control" name="address_line1" value="<%= old && old.address_line1 ? old.address_line1 : '' %>">
        </div>
        <div class="mb-3">
          <label class="form-label small">Address line 2</label>
          <input class="form-control" name="address_line2" value="<%= old && old.address_line2 ? old.address_line2 : '' %>">
        </div>

        <div class="two-col">
          <div class="mb-3">
            <label class="form-label small">City</label>
            <input class="form-control" name="city" value="<%= old && old.city ? old.city : '' %>">
          </div>
          <div class="mb-3">
            <label class="form-label small">Postal / ZIP</label>
            <input class="form-control" name="postal_code" value="<%= old && old.postal_code ? old.postal_code : '' %>">
          </div>
        </div>

        <div class="two-col">
          <div class="mb-3">
            <label class="form-label small">State / Region</label>
            <input class="form-control" name="state" value="<%= old && old.state ? old.state : '' %>">
          </div>
          <div class="mb-3">
            <label class="form-label small">Country</label>
            <input class="form-control" name="country" value="<%= old && old.country ? old.country : '' %>">
          </div>
        </div>

        <div class="mb-3 mt-2">
          <label class="form-check small">
            <input class="form-check-input" type="checkbox" name="accept_terms" <%= old && old.accept_terms ? 'checked' : '' %> required>
            <span class="form-check-label">I agree to the <a href="/terms">Terms of Service</a> and <a href="/privacy">Privacy Policy</a>.</span>
          </label>
        </div>

        <div class="mb-3">
          <button type="submit" class="btn btn-primary w-100">Create account</button>
        </div>

        <div class="text-center small-note">or sign up with</div>
        <div class="d-flex gap-2 mt-2">
          <a href="/auth/oauth/google" class="btn btn-outline-secondary w-100">Google</a>
          <a href="/auth/oauth/facebook" class="btn btn-outline-secondary w-100">Facebook</a>
        </div>

      </form>
    </div>

  </div>
</section>

<script>
  (function(){
    const form = document.getElementById('signupForm');
    form?.addEventListener('submit', function(e){
      const pwd = document.getElementById('signupPwd');
      const pwd2 = document.getElementById('signupPwd2');
      if (pwd && pwd2 && pwd.value !== pwd2.value) {
        e.preventDefault();
        alert('Passwords do not match.');
        return false;
      }
      const btn = this.querySelector('button[type="submit"]');
      if (btn) btn.disabled = true;
    });

    // password visibility toggle (double-click the password field to toggle)
    const pwd = document.getElementById('signupPwd');
    pwd?.addEventListener('dblclick', function(){
      this.type = this.type === 'password' ? 'text' : 'password';
    });

  })();
</script>
